<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Climb Log Manager</title>
    <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
    <header class="topbar">
        <div>
            <h1>Climb Log Manager</h1>
            <p class="muted">Track your climbs. Search, filter, sort, and manage logs.</p>
        </div>

        <nav class="tabs">
            <button class="tab active" data-view="list">Logs</button>
            <button class="tab" data-view="stats">Stats</button>
        </nav>
    </header>

    <main class="container">
        <!-- List View -->
        <section id="viewList" class="view">
            <div class="panel">
                <div class="view-header">
                    <h2>Your Logs</h2>

                    <div class="actions">
                        <div class="search-group">
                            <input id="searchInput" class="input" placeholder="Search route/location…" />

                            <button id="filterBtn" class="btn icon" type="button" aria-haspopup="dialog" aria-expanded="false" title="Filter">
                                <svg class="icon-svg" viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M3 5h18l-7 8v5l-4 2v-7L3 5z"></path>
                                </svg>
                                <span>Filter</span>
                            </button>

                            <select id="sortSelect" class="select sort" aria-label="Sort">
                                <option value="date_desc">Date: Newest</option>
                                <option value="date_asc">Date: Oldest</option>
                                <option value="grade_asc">Grade: Easy → Hard</option>
                                <option value="grade_desc">Grade: Hard → Easy</option>
                                <option value="location_asc">Location: A → Z</option>
                                <option value="location_desc">Location: Z → A</option>
                                <option value="route_asc">Route: A → Z</option>
                                <option value="route_desc">Route: Z → A</option>
                            </select>
                        </div>

                        <button id="newBtn" class="btn primary"> + </button>
                    </div>
                </div>

                <div id="filterPanel" class="popover hidden" role="dialog" aria-label="Filters">
                    <div class="popover-header">
                        <strong>Filters</strong>
                        <button id="filterClearBtn" class="btn small" type="button">Clear</button>
                    </div>

                    <div class="popover-section">
                        <div class="popover-title">Environment</div>
                        <label class="check"><input type="checkbox" name="filterEnv" value="outdoor" /> Outdoor</label>
                        <label class="check"><input type="checkbox" name="filterEnv" value="gym" /> Gym</label>
                    </div>

                    <div class="popover-section">
                        <div class="popover-title">Type</div>
                        <label class="check"><input type="checkbox" name="filterType" value="top-rope" /> Top Rope</label>
                        <label class="check"><input type="checkbox" name="filterType" value="sport" /> Sport / Lead</label>
                        <label class="check"><input type="checkbox" name="filterType" value="trad" /> Trad</label>
                        <label class="check"><input type="checkbox" name="filterType" value="boulder" /> Bouldering</label>
                        <p class="hint">Tip: Grade sorting is only enabled when the selected types result in one grade system (all boulder or all roped).</p>
                    </div>

                    <div class="popover-section">
                        <div class="popover-title">Progress</div>
                        <label class="check"><input type="checkbox" name="filterProgress" value="complete" /> Complete</label>
                        <label class="check"><input type="checkbox" name="filterProgress" value="incomplete" /> Incomplete</label>
                    </div>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Environment</th>
                            <th>Location</th>
                            <th>Route</th>
                            <th>Type</th>
                            <th>Grade</th>
                            <th>Progress</th>
                            <th class="right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="logsTbody"></tbody>
                </table>

                <div class="pager">
                    <button id="prevBtn" class="btn">Prev</button>
                    <span id="pageIndicator" class="muted">Page 1 of 1</span>
                    <button id="nextBtn" class="btn">Next</button>
                </div>
            </div>
        </section>

        <!-- Stats View -->
        <section id="viewStats" class="view hidden">
            <div class="panel">
                <h2>Stats</h2>
                <div class="stats">
                    <div class="stat">
                        <div class="muted">Total logs</div>
                        <div id="statTotal" class="statValue">0</div>
                    </div>
                    <div class="stat">
                        <div class="muted">Completion rate</div>
                        <div id="statCompletion" class="statValue">0%</div>
                    </div>
                    <div class="stat">
                        <div class="muted">By type</div>
                        <div id="statByType" class="statValue small">—</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form View -->
        <section id="viewForm" class="view hidden">
            <div class="panel">
                <h2 id="formTitle">Add Log</h2>

                <form id="logForm" class="form">
                    <input id="logId" type="hidden" />

                    <label class="field">
                        Date
                        <input id="date" class="input" type="date" required />
                        <small class="error" data-err-for="date"></small>
                    </label>

                    <label class="field">
                        Environment
                        <select id="environment" class="input" required>
                            <option value="">Select…</option>
                            <option value="gym">Gym</option>
                            <option value="outdoor">Outdoor</option>
                        </select>
                        <small class="error" data-err-for="environment"></small>
                    </label>

                    <label class="field">
                        Location
                        <input id="location" class="input" placeholder="e.g., BlocHaven / Table Rock" required />
                        <small class="error" data-err-for="location"></small>
                    </label>

                    <label class="field">
                        Route Name
                        <input id="routeName" class="input" placeholder="e.g., The Nose" required />
                        <small class="error" data-err-for="routeName"></small>
                    </label>

                    <label class="field">
                        Type
                        <select id="climbType" class="input" required>
                            <option value="">Select…</option>
                            <option value="top-rope">Top Rope</option>
                            <option value="sport">Sport / Lead</option>
                            <option value="trad">Trad</option>
                            <option value="boulder">Bouldering</option>
                        </select>
                        <small class="error" data-err-for="climbType"></small>
                    </label>

                    <label class="field">
                        Grade System
                        <select id="gradeSystem" class="input" required>
                            <option value="">Select…</option>
                            <option value="YDS">YDS (5.x)</option>
                            <option value="V">V-Scale (Vx)</option>
                        </select>
                        <small class="error" data-err-for="gradeSystem"></small>
                    </label>

                    <label class="field">
                        Grade
                        <select id="grade" class="input" required></select>
                        <small class="error" data-err-for="grade"></small>
                    </label>

                    <label class="field">
                        Progress
                        <select id="progress" class="input" required>
                            <option value="">Select…</option>
                            <option value="complete">Complete</option>
                            <option value="incomplete">Incomplete</option>
                        </select>
                        <small class="error" data-err-for="progress"></small>
                    </label>

                    <div class="formActions">
                        <button type="button" id="cancelBtn" class="btn">Cancel</button>
                        <button type="submit" class="btn primary">Save</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Delete Confirmation Modal -->
        <div id="modalBackdrop" class="modalBackdrop hidden">
            <div class="modal">
                <h3>Delete this log?</h3>
                <p class="muted">This cannot be undone.</p>
                <div class="modalActions">
                    <button id="deleteCancel" class="btn">Cancel</button>
                    <button id="deleteConfirm" class="btn danger">Delete</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Point this to your backend service URL.
        // When you later move to Postgres, this does NOT change (still your API base).
        window.API_BASE_URL = "https://climbing-log-manager.onrender.com";
    </script>

    <script type="module" src="assets/js/app.js"></script>
</body>
</html>
